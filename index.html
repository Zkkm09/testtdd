<!doctype html>
<html lang="en">
<head>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<title>Where is it?</title>
<style>
:root{--bg:#071224;--text:#eef2ff;--muted:#9aa4c0;--green:#2ecc71;--red:#ff4d4d}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#071224 0%,#0b2033 100%);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial}
#app{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
.stage{width:100%;max-width:900px;text-align:center}
h1.title{margin:0 0 18px 0;font-size:36px;letter-spacing:1px;font-weight:700}
.prompt{color:var(--muted);margin-bottom:18px;font-size:20px}
.images{display:flex;gap:18px;justify-content:center;align-items:center;margin-bottom:22px}
.img-block{width:220px;height:220px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 20px rgba(2,6,23,0.6);cursor:pointer;position:relative;transition:transform .12s;user-select:none}
.img-block:active{transform:translateY(2px) scale(.995)}
.img-block img{max-width:86%;max-height:86%;display:block}
.img-border{position:absolute;inset:10px;border-radius:8px;border:10px solid transparent;box-sizing:border-box;pointer-events:none;transition:border-color .18s,opacity .12s;opacity:0}
.img-border.show{opacity:1}
.img-border.green{border-color:var(--green)}
.img-border.red{border-color:var(--red)}
.img-caption{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);color:var(--muted);font-size:13px;background:rgba(0,0,0,0.25);padding:6px 10px;border-radius:999px;backdrop-filter:blur(6px)}
.final-screen{display:none;align-items:center;justify-content:center;flex-direction:column;gap:18px}
.final-screen.show{display:flex}
.you-title{font-size:96px;line-height:0.9;margin:0;color:#ffd6d6;text-shadow:0 6px 30px rgba(255,50,50,0.06)}
.big-image{width:80%;max-width:1200px;border-radius:8px;overflow:hidden;transition:width .2s ease,transform .2s ease;box-shadow:0 20px 70px rgba(2,6,23,0.6)}
.big-image.grow{width:100%;transform:scale(1.01)}
.video-full{display:none;position:fixed;inset:0;width:100vw;height:100vh;background:black;z-index:9999;align-items:center;justify-content:center}
.video-full video{width:100%;height:100%;object-fit:cover}
.loading-overlay{position:fixed;inset:0;background:#071224;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;z-index:10000}
.ready-btn{background:#1f6feb;color:white;border:none;padding:12px 22px;border-radius:10px;font-size:18px;cursor:pointer;box-shadow:0 10px 30px rgba(15,40,90,0.5)}
.hidden{display:none}
@media (max-width:640px){.img-block{width:44vw;height:44vw}.you-title{font-size:56px}.prompt{font-size:16px}}
</style>
</head>
<body>
<div id="app">
  <div class="stage" id="stage">
    <h1 class="title" id="mainTitle">Find it!</h1>
    <div class="prompt" id="prompt">Tap an image to answer</div>
    <div class="images" id="images">
      <div class="img-block" id="left" data-side="left" role="button" tabindex="0" aria-pressed="false" aria-label="left option">
        <img id="leftImg" src="" alt="left option">
        <div class="img-border" id="leftBorder"></div>
        <div class="img-caption" id="leftCaption">Left</div>
      </div>
      <div class="img-block" id="right" data-side="right" role="button" tabindex="0" aria-pressed="false" aria-label="right option">
        <img id="rightImg" src="" alt="right option">
        <div class="img-border" id="rightBorder"></div>
        <div class="img-caption" id="rightCaption">Right</div>
      </div>
    </div>
    <div class="final-screen" id="final">
      <h1 class="you-title" id="youText">YOU</h1>
      <div class="big-image" id="bigImageWrapper">
        <img id="bigImg" src="" alt="big">
      </div>
    </div>
  </div>
</div>
<div class="video-full" id="videoFull">
  <video id="finalVideo" playsinline muted autoplay preload="auto" disablepictureinpicture controlslist="nodownload noremoteplayback" webkit-playsinline></video>
</div>
<div class="loading-overlay" id="startOverlay">
  <button class="ready-btn" id="startBtn">Tap to start</button>
</div>

<script>
(function(){
const assets = {
  images: [
    {id:'tree1','src':'tree1.jpg'},
    {id:'tree2','src':'tree2.jpg'},
    {id:'ice1','src':'icecream1.jpg'},
    {id:'ice2','src':'icecream2.jpg'},
    {id:'moon1','src':'moon1.jpg'},
    {id:'moon2','src':'moon2.jpg'}
  ],
  sounds: [
    {id:'s1','src':'sound1.mp3'},
    {id:'s2','src':'sound2.mp3'},
    {id:'s3','src':'sound3.mp3'},
    {id:'s4','src':'sound4.mp3'}
  ],
  video: 'video.mp4'
};

const preloaded = {images:{},sounds:{},video:null};
const leftImg = document.getElementById('leftImg');
const rightImg = document.getElementById('rightImg');
const leftBorder = document.getElementById('leftBorder');
const rightBorder = document.getElementById('rightBorder');
const leftBlock = document.getElementById('left');
const rightBlock = document.getElementById('right');
const promptEl = document.getElementById('prompt');
const mainTitle = document.getElementById('mainTitle');
const final = document.getElementById('final');
const bigImg = document.getElementById('bigImg');
const bigImageWrapper = document.getElementById('bigImageWrapper');
const finalVideo = document.getElementById('finalVideo');
const videoFull = document.getElementById('videoFull');
const startOverlay = document.getElementById('startOverlay');
const startBtn = document.getElementById('startBtn');

let clickable = false;
let idx = 0;
let toggleTimeouts = [];
let sound4;

// Preload functions
function preloadImage(src){return new Promise(res=>{const i=new Image();i.onload=()=>res(i);i.onerror=()=>res(i);i.src=src})}
function preloadAudio(src){return new Promise(res=>{const a=new Audio();a.preload='auto';a.addEventListener('canplaythrough',()=>res(a),{once:true});a.addEventListener('error',()=>res(a),{once:true});a.src=src})}
function preloadVideo(src){return new Promise(res=>{const v=document.createElement('video');v.preload='auto';v.muted=true;v.playsInline=true;v.src=src;v.addEventListener('canplaythrough',()=>res(v),{once:true});v.addEventListener('error',()=>res(v),{once:true})})}

async function preloadAll(){
  const imgs = assets.images.map(x=>preloadImage(x.src).then(img=>{preloaded.images[x.id]=img}));
  const sds = assets.sounds.map(x=>preloadAudio(x.src).then(a=>{preloaded.sounds[x.id]=a}));
  const vid = preloadVideo(assets.video).then(v=>{preloaded.video=v});
  await Promise.all([...imgs,...sds,vid]);
}

// Questions
const questions = [
 {prompt:'Where is the tree?', leftImg:'tree1.jpg', rightImg:'icecream1.jpg', correct:0, sound:()=>preloaded.sounds['s1']},
 {prompt:'Where is icecream?', leftImg:'tree2.jpg', rightImg:'icecream2.jpg', correct:1, sound:()=>preloaded.sounds['s2']},
 {prompt:'Where is the moon?', leftImg:'moon2.jpg', rightImg:'moon1.jpg', correct:null, sound:()=>preloaded.sounds['s3'], specialToggle:true}
];

// Setup sounds
function prepareSounds(){
  sound4 = preloaded.sounds['s4'];
  if(sound4){sound4.loop=true; sound4.volume=1}
  Object.keys(preloaded.sounds).forEach(k=>preloaded.sounds[k].volume=1);
}

// Apply a question
function resetBorders(){leftBorder.className='img-border';rightBorder.className='img-border'}
function enableClicks(){clickable=true;leftBlock.style.pointerEvents='';rightBlock.style.pointerEvents=''}
function disableClicks(){clickable=false;leftBlock.style.pointerEvents='none';rightBlock.style.pointerEvents='none'}

function applyQuestion(i){
  resetBorders();
  idx=i;
  const q=questions[i];
  promptEl.textContent=q.prompt;
  leftImg.src=q.leftImg;
  rightImg.src=q.rightImg;
  document.getElementById('leftCaption').textContent='Left';
  document.getElementById('rightCaption').textContent='Right';
  clickable=true;
  enableClicks();
  const sound = q.sound();
  if(sound){
    sound.currentTime=0;
    sound.play().catch(()=>{});
  }
}

// Show borders
function showBordersForAnswer(){
  const q=questions[idx];
  resetBorders();
  if(q.correct===null){leftBorder.classList.add('show','red');rightBorder.classList.add('show','red')}
  else if(q.correct===0){leftBorder.classList.add('show','green');rightBorder.classList.add('show','red')}
  else{rightBorder.classList.add('show','green');leftBorder.classList.add('show','red')}
}

// Next question
function nextQuestion(delay=800){setTimeout(()=>{idx++;if(idx<questions.length){applyQuestion(idx)}else{setTimeout(()=>showFinalSequence(),450)}},delay)}

// Special toggle for moon question
function runSpecialToggleThenContinue(){
  leftBorder.className='img-border show red';
  rightBorder.className='img-border show red';
  const durations=[500,400,300,200,100];
  let accumulated=0;
  durations.forEach((d,i)=>{const t=accumulated+d;accumulated+=d;const id=setTimeout(()=>{
      if(i%2===0){leftBorder.className='img-border show red';rightBorder.className='img-border'}
      else{rightBorder.className='img-border show red';leftBorder.className='img-border'}
  },t); toggleTimeouts.push(id)});
  const finalizeDelay=accumulated+220;
  const finalizeTimeout=setTimeout(()=>{leftBorder.className='img-border show red';rightBorder.className='img-border show red';
      setTimeout(()=>{toggleTimeouts.forEach(t=>clearTimeout(t));toggleTimeouts=[];showFinalSequence()},320)},finalizeDelay);
  toggleTimeouts.push(finalizeTimeout);
}

// Final sequence
function showFinalSequence(){
  document.getElementById('images').style.display='none';
  promptEl.style.display='none';
  mainTitle.style.display='none';
  final.classList.add('show');
  bigImg.src='Tree1.jpg';
  setTimeout(()=>{bigImageWrapper.classList.add('grow')},80);
  setTimeout(()=>{showVideoFullScreen()},420);
}

function showVideoFullScreen(){
  videoFull.style.display='flex';
  final.style.display='none';
  const v = preloaded.video;
  if(v){
    finalVideo.src = assets.video;
    finalVideo.muted = true;
    finalVideo.autoplay = true;
    finalVideo.playsInline = true;
    finalVideo.removeAttribute('controls');
    try{finalVideo.play().catch(()=>{});}catch(e){}
  }
}

// Handle user choice
function onChoice(side){
  if(!clickable) return;
  disableClicks();
  showBordersForAnswer();
  const q=questions[idx];

  if(q.specialToggle){
    if(sound4){sound4.currentTime=0; sound4.play().catch(()=>{});}
    runSpecialToggleThenContinue();
  } else nextQuestion(750);
}

// Event listeners
leftBlock.addEventListener('click',()=>onChoice('left'));
rightBlock.addEventListener('click',()=>onChoice('right'));
leftBlock.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' ') {e.preventDefault(); onChoice('left')}})
rightBlock.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' ') {e.preventDefault(); onChoice('right')}})
window.addEventListener('beforeunload',()=>{toggleTimeouts.forEach(t=>clearTimeout(t))})

// Preload assets and setup overlay
preloadAll().then(()=>{
  prepareSounds();
  startBtn.addEventListener('click',()=>{
    startOverlay.style.display='none';
    applyQuestion(0); // Play first question sound on first tap
  });
});
})();
</script>

</body>
</html>


